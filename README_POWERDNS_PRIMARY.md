# PowerDNS Primary

This provides the ansible to set up and run a [PowerDNS Authoritative Nameserver](https://doc.powerdns.com/authoritative/index.html).

This will include an HTTP WebAdmin UI running through `nginx`, on port 80 that supports per-user logins and access to the
PowerDNS API using HTTP BASIC authentication, instead of a shared key.

The WebUI is for admin purposes only. Although it supports individual user logins, all users have full permissions
to do whatever the PowerDNS API supports. This includes dropping entire zones.

It also includes an internal ISC `bind` server that will convert the AXFR zone transfer of PowerDNS
into the more standard IXFR. This will provide significantly faster zone updates, especially for
larger or signed zones.

 
## Supported Backends

This ansible supports either the Sqlite3 or MySQL backends for storing your DNS data.
The Sqlite3 requires no special configuration
and will simply store its data in the `{{powerdns_primary_data_directory}}`.

To use the MySQL backend, you must provide a `{{powerdns_primary_mysql_password}}`. This can be
generated by the script `powerdns_primary_make_mysql_password` which will automatically then encrypt
it into an `ansible vault`. Ansible vaults are considered safe to store in public code repos.

If you choose the MySQL backend, it will automatically install & run MariaDB and create
the necessary database & login.

MySQL will be faster, but require a little more work to administer. For example, to backup
the Sqlite3 data, you just take a copy of the data directory.

Sqlite3 will be fine for smaller installations.

Once you have DNS data in the system changing backends is not particualarly easy.


## Supported Tweaks

In the file `group_vars/powerdns_primary/main.yaml` you can tweak the follow values

| Option | Default | Meaning
|--------|---------|--------
| powerdns_primary_data_directory | `/opt/data/powerdns-primary` | Host's directory for storing data, e.g. Sqlite3 data
| powerdns_primary_use_sqlite3 | true | Use the Sqlite3 backend for storing DNS data
| powerdns_primary_pdns_log_level | 5 | PowerDNS log level
| powerdns_primary_pdns_log_facility | 6 | PowerDNS log facility
| powerdns_primary_pdns_catalog_zone | `lst.zz` | Domain Name to use as a catalog for listing all zones you have in the database
| powerdns_primary_secondary_servers | `127.1.0.1` | List of IP Addresses of your secondary name servers
| powerdns_primary_admin_logins | admin:[password] | Logins for the WebUI

By default the only login will be

	  admin: "$6$TSkuVedfuG/Jqjek$seN4GFhfdUL/QAITGdfHW02GDzB6gU0zs7OZjfdNryE7SNGNtAPSiE76.zlvWSo4TiAeeQTpztoNF7R0WmDcj0"

This is user: `admin`, password: `admin` - you can use `openssl passwd -6 [password]` to encrypt a password in this
format (SHA512).

## The Catalog Zone

A Catalog Zone is a meta-zone that is used to list the domains you want secondary name servers to upload.

The default catalog zone is `lst.zz`, but you will need to create it manually in the beginning. It's type
should be `Producer`.

As you create zones you need to manually add them to the catalog. To do this, go into the zone's `META` data
and for the metadata item `CATALOG` just set the value `lst.zz`.

If you wish, you can have multiple catalog zones, but this is the one that the internal `bind` will
use to know which zones ti run the IXFR convertion on. Therefore, this the one you would probably
give to your `{{powerdns_primary_secondary_servers}}`, to tell them which zones you want them to be loading up.

